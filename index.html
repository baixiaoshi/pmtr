<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.6" />
<title>pmtr job manager</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>pmtr job manager</h1>
<span id="author">Troy D. Hanson</span><br />
<span id="email"><tt>&lt;<a href="mailto:tdh@tkhanson.net">tdh@tkhanson.net</a>&gt;</tt></span><br />
<span id="revnumber">version 1.2,</span>
<span id="revdate">September 2012</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_what_does_pmtr_do">What does pmtr do?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Pmtr is a process monitor for starting your servers at system boot, and keeping
them running. It&#8217;s a small utility, written in C.  It&#8217;s free, open-source and
for Linux only.  With pmtr, all your jobs are defined in one configuration file:</p></div>
<div class="listingblock">
<div class="title">Example <tt>/etc/pmtr.conf</tt></div>
<div class="content">
<pre><tt>  job {
    name minecraft-server
    dir /home/mc
    cmd /usr/bin/java -jar minecraft_server.jar nogui
    err mc.err
    out mc.out
    user mc
  }

  job {
    name cpu-monitor
    cmd /bin/cpu-monitor -x
  }</tt></pre>
</div></div>
<div class="paragraph"><p>Here, for the sake of illustration, we&#8217;re running a Minecraft server and
a CPU monitoring job. As you can see- only the name and command are required.
If you want to, you can specify the working directory, a user other than root
to run the process, and where to put the output and error.  The <a href="#options">full options</a> are documented below.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Why did I write it?</div>
<div class="paragraph"><p>I wrote pmtr because I wanted to have all my application jobs listed in one
easily-edited configuration file. I also wanted them kept separate from the
system daemons managed by sysvinit and similar mechanisms.</p></div>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_download_amp_install">Download &amp; Install</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_platforms">Platforms</h3>
<div class="paragraph"><p>Pmtr is <strong>Linux only</strong>, because it uses inotify. (It&#8217;d probably be an easy
port to other Unix variants. If you do, feel free to send me a patch.)</p></div>
<div class="paragraph"><p>It&#8217;s been tested on:</p></div>
<div class="ulist"><ul>
<li>
<p>
Ubuntu (10.04)
</p>
</li>
<li>
<p>
Debian (6.0.4)
</p>
</li>
<li>
<p>
RHEL (6.3)
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_download_options">Download options</h3>
<div class="paragraph"><p>You can download pmtr either of these ways:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Clone the git repository
</dt>
<dd>
<p>
  git clone git://github.com/troydhanson/pmtr.git
</p>
</dd>
<dt class="hdlist1">
Download a tarball
</dt>
<dd>
<p>
  A tarball is available at: <a href="https://github.com/troydhanson/pmtr/tarball/master">https://github.com/troydhanson/pmtr/tarball/master</a>
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_build_and_install">Build and install</h3>
<div class="paragraph"><p>To build and install:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>cd pmtr
make
sudo make install</tt></pre>
</div></div>
<div class="paragraph"><p>The result of installation is:</p></div>
<div class="ulist"><ul>
<li>
<p>
the binary itself <tt>/usr/bin/pmtr</tt>,
</p>
</li>
<li>
<p>
the configuration file <tt>/etc/pmtr.conf</tt> which is initially empty,
</p>
</li>
<li>
<p>
a system startup script that runs pmtr at boot as described next.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Upon completion of <tt>sudo make install</tt>, pmtr should be running. Verify using:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>service pmtr status</tt></pre>
</div></div>
<div class="sect3">
<h4 id="_who_starts_pmtr_at_boot">Who starts pmtr at boot?</h4>
<div class="paragraph"><p>Pmtr starts up automatically during the boot process. An OS-specific initscript
makes this happen. (They&#8217;re in the <tt>initscripts/</tt> directory if you&#8217;re curious).
Manual control is supported. You can use your system&#8217;s <tt>service</tt> command to run
the usual administrative commands, like <tt>service pmtr start</tt> or <tt>stop</tt>.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logging">Logging</h2>
<div class="sectionbody">
<div class="paragraph"><p>Status messages are sent to <strong>syslog</strong>. Typically these go to <tt>/var/log/messages</tt>:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Nov  7 22:01:09 ubuntu pmtr[18477]: rescanning job configuration
Nov  7 21:38:10 ubuntu pmtr[18477]: pmtr: managing 1 jobs
Nov  7 21:38:10 ubuntu pmtr[18477]: started job doppler [18478]</tt></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_jobs">Jobs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_requirements">Requirements</h3>
<div class="paragraph"><p>Jobs that you intend to run under <tt>pmtr</tt> should:</p></div>
<div class="ulist"><ul>
<li>
<p>
stay in the <strong>foreground</strong>
</p>
</li>
<li>
<p>
<strong>exit</strong> on SIGTERM or SIGKILL
</p>
</li>
<li>
<p>
arrange so any <strong>sub-processes exit</strong> if the job itself exits
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_clean_exits">Clean exits</h4>
<div class="paragraph"><p>Note the last bullet. Shell scripts are especially likely to leave sub-processes
around if they exit.  (Shells don&#8217;t always pass signals down to their children).
For example, if you have a shell script like this,</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>#!/bin/bash
command | etc</tt></pre>
</div></div>
<div class="paragraph"><p>and if you run this shell script as a <tt>pmtr</tt> job, then later delete or disable
the job while it&#8217;s running, pmtr signals the shell process to exit-- but the
sub-processes <tt>command</tt> and <tt>etc</tt> may continue to run. Avoid this-- instead,
construct your jobs to exit cleanly, so sub-processes exit if the parent exits.
(For example, C programs on Linux can use <tt>prctl(PR_SET_PDEATHSIG, SIGHUP);</tt>
to get signalled if the parent exits).</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_job_control">Job control</h3>
<div class="paragraph"><p>When you edit and save <tt>pmtr.conf</tt>, the changes you made get applied immediately.</p></div>
<div class="ulist"><ul>
<li>
<p>
If you add a job, it gets started.
</p>
</li>
<li>
<p>
If you delete a job, or give it the <tt>disable</tt> option, or comment it out, it
   gets terminated.
</p>
</li>
<li>
<p>
If you change a job, it gets restarted with the new settings.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Other running jobs are left alone- they&#8217;re not needlessly restarted. All this
happens immediately whenever the configuration file is modified.</p></div>
</div>
<div class="sect2">
<h3 id="_job_restart">Job restart</h3>
<div class="paragraph"><p>When a job exits-- assuming it&#8217;s been running at least ten seconds-- pmtr restarts
it.</p></div>
<div class="sect3">
<h4 id="_inhibiting_restart">Inhibiting restart</h4>
<div class="paragraph"><p>There are two ways to inhibit automatic restart: the job itself can exit
with status 33, which pmtr interprets as a "don&#8217;t restart" indicator; or the
the job can use the  <em>once</em> option in the configuration file, described below.</p></div>
</div>
<div class="sect3">
<h4 id="_avoiding_fast_restarts">Avoiding fast restarts</h4>
<div class="paragraph"><p>When a job exits less than 10 seconds after it started, pmtr waits ten seconds
before restarting it.  This avoids rapid restart loops.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Nov  7 22:01:13 ubuntu pmtr[18477]: job xyz 18552 exited after 3 sec: exit status 0
Nov  7 22:01:13 ubuntu pmtr[18477]: job restarting too fast, delaying restart</tt></pre>
</div></div>
<div class="paragraph"><p>Since pmtr is oriented toward running daemons, a quick exit usually means the
job has some kind of problem (bad arguments, etc) that need to be fixed.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_job_shutdown">Job shutdown</h3>
<div class="paragraph"><p>You can stop a job running under <tt>pmtr</tt> by opening the configuration file and
deleting (or commenting out) the job definition, or using the <tt>disable</tt> option:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>job {
  name tw-sender
  cmd /usr/bin/tw-sender -a
  disable
}</tt></pre>
</div></div>
<div class="paragraph"><p>When you save the configuration file, pmtr re-scans it, notices the change and
terminates the job.  Job termination is handled by sending SIGTERM, then
SIGKILL shortly afterward.</p></div>
<div class="paragraph"><p>If you stop pmtr (for example, by running <tt>service pmtr stop</tt>), it terminates
all its jobs before exiting.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_file">Configuration file</h2>
<div class="sectionbody">
<div class="paragraph"><p>When pmtr is started at system boot, it reads the configuration file&#8201;&#8212;&#8201;by default <tt>/etc/pmtr.conf</tt>&#8201;&#8212;&#8201;and starts up the jobs defined there.</p></div>
<div class="sect2">
<h3 id="_syntax">Syntax</h3>
<div class="paragraph"><p>The configuration file contains any number of jobs. Each job is in a curly-brace
delimited block.  Comments should be on their own line and prefaced with <tt>#</tt>.
Indentation is optional. Blank lines are ok.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>#####################
# temperature sensor
#####################
job {
  name temp
  cmd /usr/bin/temp-sensor -a "st paul"
  dir /usr/temp
  out temp.out
  err temp.err
}</tt></pre>
</div></div>
<div class="paragraph"><p>Only <em>name</em> and <em>cmd</em> are required. The <tt>cmd</tt> is the <strong>absolute path</strong> to the
executable (which must have its executable bit set). The command may contain
options and simple double-quoted arguments.</p></div>
</div>
<div class="sect2">
<h3 id="_job_options">Job options</h3>
<div class="tableblock" id="options">
<table rules="none"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="83%" />
<thead>
<tr>
<th align="left" valign="top">option         </th>
<th align="left" valign="top"> argument</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>name</tt></p></td>
<td align="left" valign="top"><p class="table">job name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>cmd</tt></p></td>
<td align="left" valign="top"><p class="table">absolute path to executable with optional arguments</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>dir</tt></p></td>
<td align="left" valign="top"><p class="table">absolute path to the working directory</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>out</tt></p></td>
<td align="left" valign="top"><p class="table">file to receive standard output</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>err</tt></p></td>
<td align="left" valign="top"><p class="table">file to receive standard error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>user</tt></p></td>
<td align="left" valign="top"><p class="table">user under whose uid the job should run</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>env</tt></p></td>
<td align="left" valign="top"><p class="table"><tt>VAR=VALUE</tt> environment variable settings (repeatable)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>disable</tt></p></td>
<td align="left" valign="top"><p class="table">special shortcut to disable a job, usually temporarily</p></td>
</tr>
</tbody>
</table>
</div>
<div class="dlist"><dl>
<dt class="hdlist1">
name
</dt>
<dd>
<p>
  The <em>name</em> must be unique. It is used to make log messages more readable.
</p>
</dd>
<dt class="hdlist1">
cmd
</dt>
<dd>
<p>
  The <em>cmd</em> is the absolute pathname to an executable, with optional arguments.
  Quoting (using double-quotes only) is supported in the arguments.
</p>
</dd>
<dt class="hdlist1">
dir
</dt>
<dd>
<p>
  Sets the <em>working directory</em> that the job will have upon startup.
</p>
</dd>
<dt class="hdlist1">
out
</dt>
<dd>
<p>
  file (may be relative to the working directory) to receive stdout. Default: <tt>/dev/null</tt>
</p>
</dd>
<dt class="hdlist1">
err
</dt>
<dd>
<p>
  file (may be relative to the working directory) to receive stderr. Default: <tt>/dev/null</tt>
</p>
</dd>
<dt class="hdlist1">
user
</dt>
<dd>
<p>
  If specified, the job is run under the user&#8217;s uid rather than root&#8217;s uid
</p>
</dd>
<dt class="hdlist1">
env
</dt>
<dd>
<p>
  sets an environment variables for the job, e.g., <tt>env XLIB=/usr/lib/xlib.so</tt> (repeatable)
</p>
</dd>
<dt class="hdlist1">
disable
</dt>
<dd>
<p>
  causes the job definition to be inactive. This is sometimes more convenient
  than commenting out the whole job definition.
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_one_time_jobs">One-time jobs</h3>
<div class="paragraph"><p>Sometimes we want to run one or more "setup" jobs before our daemons. The setup
job should run to completion, and not be restarted when it exits. For this, you
can use the <tt>wait</tt> option and the <tt>once</tt> option.  When a job has the <tt>wait</tt>
option, pmtr waits until it exits before starting up subsequent jobs (those
which appear later in the configuration file).  This is used with <em>once</em> to
prevent the job from restarting. (You can also use <tt>once</tt> without <tt>wait</tt>).</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>job {
  name setup
  cmd /bin/mkdir /dev/shm/ramdisk
  wait
  once
}</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_manaul_startup_options">Manaul startup options</h3>
<div class="paragraph"><p>Normally the only reason to run <tt>pmtr</tt> manually is to test the validity of a
configuration file. The supported options to pmtr are:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>-t test; parse config file only (implies -F)
-c &lt;file&gt; specify configuration file
-F foreground
-v verbose</tt></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_news">News</h3>
<div class="paragraph"><p>Updates are posted to the <a href="http://tkhanson.net/blog">author&#8217;s blog</a>. <span class="image">
<img src="rss.png" alt="(RSS)" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_other_software">Other software</h3>
<div class="paragraph"><p>The author&#8217;s other open-source software are listed at <a href="http://tkhanson.net">http://tkhanson.net</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_contact">Contact</h3>
<div class="paragraph"><p>Please send bug reports or suggestions to <a href="mailto:tdh@tkhanson.net">tdh@tkhanson.net</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph"><p>See the <a href="LICENSE.txt">LICENSE</a> file.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 1.2<br />
Last updated 2012-09-03 12:09:14 EDT
</div>
</div>
</body>
</html>
