<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.7" />
<title>pmtr job manager</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>pmtr job manager</h1>
<span id="author">Troy D. Hanson</span><br />
<span id="email"><tt>&lt;<a href="mailto:tdh@tkhanson.net">tdh@tkhanson.net</a>&gt;</tt></span><br />
<span id="revdate">v1.3 November 2013</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_what_does_pmtr_do">What does pmtr do?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Pmtr is a process monitor for starting your servers at system boot, and keeping
them running. It&#8217;s small, written in C, free, open-source and for Linux only.
With pmtr, all your jobs are defined in one configuration file:</p></div>
<div class="listingblock">
<div class="title">Example <tt>/etc/pmtr.conf</tt></div>
<div class="content">
<pre><tt>  job {
    name app-webserver
    cmd /home/app/webserver.py
  }

  job {
    name app-server
    dir /home/app
    cmd /home/app/server -c 20
    out server.out
    err server.err
    user app
  }</tt></pre>
</div></div>
<div class="paragraph"><p>Only the <tt>name</tt> used for logging and <tt>cmd</tt> (the command) are required.  The
following are optional: the working directory, files to receive stderr and
stdout, and the user whose id should run the process. See the <a href="#options">full options</a> below.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Why did I write it?</div>
<div class="paragraph"><p>I wrote pmtr because I wanted to have all my application jobs listed in one
easily-edited configuration file. I also wanted them kept separate from the
system services managed by sysvinit, upstart or similar mechanisms.</p></div>
</div></div>
<div class="paragraph"><p>Some of the other features of pmtr are protection against jobs that restart too
fast, automatic re-scanning of an updated configuration file, and basic remote
reporting. Note that the jobs should stay in the foreground so pmtr can detect
if they restart. See the <a href="#requirements">requirements for pmtr jobs</a> below.</p></div>
<div class="paragraph"><p>Pmtr has been used in production to manage jobs on hundreds on Linux systems.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_download_amp_install">Download &amp; Install</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_platforms">Platforms</h3>
<div class="paragraph"><p>Pmtr is for Linux only. It&#8217;s been tested on:</p></div>
<div class="ulist"><ul>
<li>
<p>
Ubuntu (10+)
</p>
</li>
<li>
<p>
CentOS/RHEL (6+)
</p>
</li>
<li>
<p>
Debian (6+)
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_download_options">Download options</h3>
<div class="paragraph"><p>You can:</p></div>
<div class="ulist"><ul>
<li>
<p>
download a <a href="https://github.com/troydhanson/pmtr/archive/master.zip">zipfile here</a>.
</p>
</li>
<li>
<p>
Or clone the git repository: <tt>git clone https://github.com/troydhanson/pmtr.git</tt>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_build_and_install">Build and install</h3>
<div class="paragraph"><p>To build and install:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>cd pmtr
make
(if pmtr is already running, stop it using service pmtr stop)
sudo make install</tt></pre>
</div></div>
<div class="paragraph"><p>The result of installation is:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>/usr/bin/pmtr</tt> - the executable
</p>
</li>
<li>
<p>
<tt>/etc/pmtr.conf</tt> - the configuration file (initially empty)
</p>
</li>
<li>
<p>
<tt>/usr/bin/pmtr-rptserver</tt> - for remote monitoring of ptmr jobs
</p>
</li>
<li>
<p>
<tt>/usr/bin/pmtr-ctl</tt> - for remote disabling and enabling of jobs
</p>
</li>
<li>
<p>
an OS-specific startup script that runs pmtr at boot
</p>
</li>
</ul></div>
<div class="paragraph"><p>Upon completion of <tt>sudo make install</tt>, pmtr should be running. Verify using:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>service pmtr status</tt></pre>
</div></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Who starts pmtr?</div>
<div class="paragraph"><p>Pmtr starts up automatically during the boot process. An OS-specific initscript
makes this happen.  You can use your system&#8217;s <tt>service</tt> command to start and
stop pmtr manually (like <tt>service pmtr start</tt>), but normally you just let the OS
start up pmtr automatically at boot.</p></div>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_file">Configuration file</h2>
<div class="sectionbody">
<div class="paragraph"><p>When pmtr is started at system boot, it reads the configuration file&#8201;&#8212;&#8201;by default <tt>/etc/pmtr.conf</tt>&#8201;&#8212;&#8201;and starts up the jobs defined there.</p></div>
<div class="sect2">
<h3 id="_syntax">Syntax</h3>
<div class="paragraph"><p>The configuration file contains any number of jobs. Each job is in a curly-brace
delimited block.  Indentation is optional. Blank lines are ok.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt># this is a comment
job {
  name geo-server
  cmd /usr/bin/server -e "New York"
}</tt></pre>
</div></div>
<div class="paragraph"><p>Only <em>name</em> and <em>cmd</em> are required. The <tt>cmd</tt> is the absolute path to the
executable. It must have its executable bit set.  The command may contain
arguments; double-quote the arguments if they contain spaces. Comments should
be on their own line and start with <tt>#</tt>.</p></div>
</div>
<div class="sect2">
<h3 id="_job_options">Job options</h3>
<div class="tableblock" id="options">
<table rules="none"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="83%" />
<thead>
<tr>
<th align="left" valign="top">option         </th>
<th align="left" valign="top"> argument</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>name</tt></p></td>
<td align="left" valign="top"><p class="table">job name (used for logging)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>cmd</tt></p></td>
<td align="left" valign="top"><p class="table">absolute path to executable, with optional arguments</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>dir</tt></p></td>
<td align="left" valign="top"><p class="table">optional- absolute path to the working directory</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>out</tt></p></td>
<td align="left" valign="top"><p class="table">optional- file to receive stdout</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>err</tt></p></td>
<td align="left" valign="top"><p class="table">optional- file to receive stderr</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>in</tt></p></td>
<td align="left" valign="top"><p class="table">optional- file to set up as stdin</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>user</tt></p></td>
<td align="left" valign="top"><p class="table">optional- user whose id to run the job as</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>env</tt></p></td>
<td align="left" valign="top"><p class="table">optional- <tt>VAR=VALUE</tt> environment variable settings (repeatable)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>disable</tt></p></td>
<td align="left" valign="top"><p class="table">optional- if present, disables the job</p></td>
</tr>
</tbody>
</table>
</div>
<div class="dlist"><dl>
<dt class="hdlist1">
name
</dt>
<dd>
<p>
  unique <em>name</em> for the job, to make log messages more readable
</p>
</dd>
<dt class="hdlist1">
cmd
</dt>
<dd>
<p>
  the absolute pathname to an executable, with optional arguments.
  Quoting using double-quotes is supported in the arguments.
</p>
</dd>
<dt class="hdlist1">
dir
</dt>
<dd>
<p>
  set the <em>working directory</em> that the job will have upon startup.
</p>
</dd>
<dt class="hdlist1">
in
</dt>
<dd>
<p>
  file to open as stdin. Default: <tt>/dev/null</tt>
</p>
</dd>
<dt class="hdlist1">
out
</dt>
<dd>
<p>
  file to receive stdout. Default: <tt>/dev/null</tt>
</p>
</dd>
<dt class="hdlist1">
err
</dt>
<dd>
<p>
  file to receive stderr. Default: <tt>/dev/null</tt>
</p>
</dd>
<dt class="hdlist1">
user
</dt>
<dd>
<p>
  the unix username whose id should execute the job. Default: root.
</p>
</dd>
<dt class="hdlist1">
env
</dt>
<dd>
<p>
  set an environment variable for the job, e.g., <tt>env DEBUG=1</tt> (repeatable)
</p>
</dd>
<dt class="hdlist1">
disable
</dt>
<dd>
<p>
  make the job inactive. Can be used instead of commenting out the job definition.
</p>
</dd>
</dl></div>
<div class="sect3">
<h4 id="_one_time_jobs">One-time jobs</h4>
<div class="paragraph"><p>Pmtr has limited support for one-time jobs intended for "initial setup" type of
situations.  There are two options that are used for this.  The <tt>wait</tt> option
prevents pmtr from going on to start subsequent jobs, until this one exits.
Then, <tt>once</tt> tells pmtr not to restart it. (If pmtr itself is restarted, or if
the job configuration is changed, the job would be executed once again).</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>job {
  name setup-ramdisk
  cmd /bin/mkdir /dev/shm/app-ramdisk
  wait
  once
}</tt></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_config_file_syntax">Testing config file syntax</h3>
<div class="paragraph"><p>You can check the syntax of a configuration file using <tt>-t</tt> (test syntax only)
which may be used with <tt>-c</tt> to specify a configuration to test. Any syntax errors
are displayed; the exit code is always 0.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>pmtr -tc /tmp/pmtr.conf</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_when_do_configuration_changes_take_effect">When do configuration changes take effect?</h3>
<div class="paragraph"><p>When you edit and save <tt>pmtr.conf</tt>, the changes get applied immediately. Pmtr
watchces the configuration file to notice when it has been updated. The changes
are applied minimally - only jobs whose definition has changed are affected.</p></div>
<div class="ulist"><ul>
<li>
<p>
A newly-added job gets started.
</p>
</li>
<li>
<p>
A deleted job is terminated.
</p>
</li>
<li>
<p>
A changed job is restarted with its new configuration.
</p>
</li>
</ul></div>
<div class="paragraph"><p>To terminate a job, pmtr sends SIGTERM to it, then SIGKILL shortly afterward.</p></div>
<div class="paragraph"><p>If you stop pmtr itself (for example, by running <tt>service pmtr stop</tt>), it
terminates its jobs before exiting.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jobs">Jobs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_logging">Logging</h3>
<div class="paragraph"><p>As jobs start up, exit, and so on, messages are sent to <strong>syslog</strong>. Depending on
your syslog configuration, the messages might go to <tt>/var/log/syslog</tt>, or
<tt>/var/log/messages</tt>, or somewhere else. Typical log messages are like:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Nov  7 22:01:09 ubuntu pmtr[18477]: rescanning job configuration
Nov  7 21:38:10 ubuntu pmtr[18477]: pmtr: managing 1 jobs
Nov  7 21:38:10 ubuntu pmtr[18477]: started job doppler [18478]</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Look for errors</div>If there&#8217;s a syntax error or other problem (such as invalid user) in
your configuration, pmtr can only communicate that back to you in the
log messages - so be sure you check them when making config changes!</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="requirements">Is the job suitable to run under pmtr?</h3>
<div class="paragraph"><p>Jobs that you intend to run under <tt>pmtr</tt> should:</p></div>
<div class="ulist"><ul>
<li>
<p>
stay in the <strong>foreground</strong>
</p>
</li>
<li>
<p>
<strong>exit</strong> on SIGTERM or SIGKILL
</p>
</li>
<li>
<p>
cause any <strong>sub-processes</strong> to exit if the job exits
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_restart_handling">Restart handling</h3>
<div class="paragraph"><p>Pmtr restarts a job that exits, provided it&#8217;s been running at least ten seconds.</p></div>
<div class="sect3">
<h4 id="_rapid_restart_prevention">Rapid restart prevention</h4>
<div class="paragraph"><p>If a job exits quickly after starting (less than 10 seconds after it started),
pmtr waits ten seconds before restarting it. This avoids rapid restart cycles.
For servers, a quick exit often means the job has some sort of configuration problem.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Nov  7 22:01:13 ubuntu pmtr[18477]: job app-server 8552 exited after 0 sec: exit status 0</tt></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_exit_status">Exit status</h4>
<div class="paragraph"><p>A job that exits normally or terminates due to a signal is logged with its exit
code or signal number. Note that exit code 33 is special. If pmtr sees a job
exit with code 33 it does not restart it.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_remote_control">Remote control</h2>
<div class="sectionbody">
<div class="paragraph"><p>Two special configuration options can appear in <tt>pmtr.conf</tt>. The first is
<tt>report to</tt> which causes pmtr to send a periodic (every 10 seconds) status
message to the remote UDP endpoint whose IP address and port number are listed.
It can be repeated multiple times to report to multiple remote endpoints.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>report to udp://127.0.0.1:9999</tt></pre>
</div></div>
<div class="paragraph"><p>The script in <tt>pmtr-rptserver</tt> can be run on a remote system to receive these
packets and maintain a file with the status of all reporting systems. E.g.,</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>/usr/bin/pmtr-rptserver -p 9999 -f /var/log/pmtr-status.txt</tt></pre>
</div></div>
<div class="paragraph"><p>The other special option allows remote systems to enable or disable pmtr jobs.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>listen on udp://0.0.0.0:10000</tt></pre>
</div></div>
<div class="paragraph"><p>With that specification, pmtr listens on all local IP addresses (0.0.0.0) on
port 10000 for UDP messages of the form "enable xyz" or "disable xyz". There is
a script to make it easy to send these messages like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>/usr/bin/pmtr-ctl -s 127.0.0.1 -p 10000 enable app-server</tt></pre>
</div></div>
<div class="paragraph"><p>This is intended for temporary job enabling or disabling. If <tt>pmtr.conf</tt> is
edited or if pmtr is restarted, the settings in the <tt>pmtr.conf</tt> take effect.</p></div>
<div class="paragraph"><p>There is no authentication with the <tt>listen on</tt> feature- use it only on trusted
internal networks.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_news">News</h3>
<div class="paragraph"><p>Updates are posted to the <a href="http://tkhanson.net/blog">author&#8217;s blog</a>. <span class="image">
<img src="rss.png" alt="(RSS)" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_contributing">Contributing</h3>
<div class="paragraph"><p>Feel free to send pull requests through the <a href="https://github.com/troydhanson/pmtr">pmtr Github page</a>.
Please send bug reports or suggestions through GitHub. You can also email me at
<a href="mailto:tdh@tkhanson.net">tdh@tkhanson.net</a>, but I&#8217;m often behind by weeks or months in getting back to people.</p></div>
</div>
<div class="sect2">
<h3 id="_other_software">Other software</h3>
<div class="paragraph"><p>The author&#8217;s other open-source software are listed at <a href="http://tkhanson.net">http://tkhanson.net</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph"><p>See the <a href="LICENSE.txt">LICENSE</a> file.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2013-11-12 12:24:16 EST
</div>
</div>
</body>
</html>
