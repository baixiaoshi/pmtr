<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>proctab</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>proctab</h1>
<span id="author">Troy D. Hanson</span><br />
<span id="email"><code>&lt;<a href="mailto:tdh@tkhanson.net">tdh@tkhanson.net</a>&gt;</code></span><br />
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Back to the <a href="https://github.com/troydhanson/proctab">proctab Github page</a>.</p></div>
<div class="paragraph"><p>To run services on Linux systems one typically writes an initscript. The init
mechanism, and the syntax of initscripts, vary depending on the distribution.</p></div>
<div class="paragraph"><div class="title">proctab</div><p>Proctab is one of my <a href="http://troydhanson.github.io/">many C projects</a>. I wrote it
for sensors and appliances that have lots of related jobs that are easier to
manage through one configuration file. Also, to insulate the developer from
the underlying init system which varies widely.</p></div>
<div class="paragraph"><p>I wrote <em>proctab</em> to complement rather than replace the underlying init system.
It runs under systemd, sysvinit or upstart that already exists on a Linux host.
Its configuration file <code>/etc/proctab.conf</code> lists the services it should start.
It starts them at boot, and restarts them as needed.  Proctab is written in C,
Linux only, and is <a href="LICENSE.txt">MIT</a> licensed.</p></div>
<div class="ulist"><div class="title">Platforms</div><ul>
<li>
<p>
Ubuntu (12, 13, 14, 15, 16)
</p>
</li>
<li>
<p>
CentOS/RHEL (5, 6, 7)
</p>
</li>
<li>
<p>
Raspberry Pi (Raspbian)
</p>
</li>
<li>
<p>
Debian
</p>
</li>
<li>
<p>
Arch
</p>
</li>
<li>
<p>
Yocto <a href="https://github.com/troydhanson/meta-proctab">(layer)</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Guide to proctab</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Download, build and install
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Build
^^^^^

To build it from the git repository,

    git clone https://github.com/troydhanson/proctab.git
    cd proctab
    ./autogen.sh
    ./configure --bindir=/usr/bin --sysconfdir=/etc
    make

Install
^^^^^^^

To install the executable `/usr/bin/proctab` and the configuration file `/etc/proctab.conf`:

    sudo make install
    sudo touch /etc/proctab.conf

Initscript
^^^^^^^^^^

To have proctab installed a service, detecting the host init system automatically:

    cd initscripts
    sudo ./setup-initscript --install-service auto --bindir /usr/bin \
       --enable-service --start-service

Note that `--bindir` should match the one given to "configure" in the build
step. You can also run `./setup-initscript -h` to see its full set of options.

proctab.conf
~~~~~~~~~~~~

The config file `/etc/proctab.conf` lists the processes for proctab to run. It
uses the term "job" to mean a service or a process.

.Example `/etc/proctab.conf`</code></pre>
</div></div>
<div class="paragraph"><p>job {
  name set-audio-source
  cmd /usr/bin/Record_from_lineIn.sh
  wait
  once
}</p></div>
<div class="paragraph"><p>job {
  name send-audio-to-icecast
  cmd /usr/bin/darkice -c /etc/darkice.cfg
  depends {
      /etc/darkice.cfg
  }
}</p></div>
<div class="paragraph"><p>job {
  name tunnel
  cmd /usr/bin/ssh -i key -TNL 5901:127.0.0.1:5901 192.168.0.1
}</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Here we have a proctab configuration that runs three jobs. The
first one is a one-time, setup job that proctab won't restart. The
next two are a Darkice audio streamer and a persistent SSH tunnel.

There are many &lt;&lt;config_options,proctab configuration options&gt;&gt;.
The minimal requirement is that each job has a name and a cmd.

.depends

In the example above, darkice depends on `/etc/darkice.cfg`. This makes proctab
restart darkice whenever darkice.cfg is edited. Proctab watches for these file
events efficiently using inotify. It restarts darkice if the content (thus, the
hash) of darkice.cfg changes. A simple open/close of darkice.cfg with no changes
will not restart the job. A job can depend on multiple files, listed one per
line.

.No shell or $PATH

There is no shell interpretation of the command or its arguments. There is no
searching for the command in $PATH. Use absolute paths on commands.  The only
quoting support is double-quotes in command options. For example you can pass
a string into a shell this way:

  cmd /bin/bash -c "killall Xvnc; vncserver :1"

.General rules

* Each job is in a curly-brace delimited block.
* The order of options inside does not matter.
* Only the `name` and `cmd` are required.
* Indentation is optional.
* Blank lines are ok.
* Comments start with `#` and must be on their own line.
* Processes that run under proctab should,
** stay in the foreground
** exit on SIGTERM or SIGKILL
** clean up their own sub-processes

.Another example job

Here is another job with many options.</code></pre>
</div></div>
<div class="paragraph"><p># example of a process with lots of options
job {
  name generate-data
  dir /home/discovery
  cmd /usr/bin/perl gen.pl --remotes /tmp/a /tmp/b
  depends {
    /tmp/a
    /tmp/b
  }
  user daemon
  env PERLLIB=/home/discovery/lib
  ulimit -n infinity
  bounce every 1d
  out /var/log/gen.log
  err /var/log/gen.err
}</p></div>
<div class="listingblock">
<div class="content">
<pre><code>.bounce every

Among the options shown job above is `bounce every 1d`. (The `d` is for day).
This options is for scripts or other processes that might benefit from a
periodic restart. It also takes hour or minute units e.g. `2h` or `5m`.

.ulimit

The job above can open infinite file descriptors (well, it can try) because
`ulimit -n infinite` allows it. There are many limits that can be explicitly set
in this way.  Type `ulimit -a` or `help limit` in a bash shell to see them.

.stdout and stderr

As shown the stdout and stderr can be redirected to files. Otherwise they
are sent to `/dev/null`.

.Environment variables

Environment variables can be set for a job by lines of the form `env VAR=value`.

.Edits

When you edit and save `proctab.conf`, proctab applies the changes immediately.

 * A newly-added job gets started.
 * A deleted job is terminated.
 * A changed job is restarted with its new configuration.

Job termination
~~~~~~~~~~~~~~~

.Proctab-induced

To terminate a job, proctab sends SIGTERM to it, then SIGKILL shortly afterward
it it's still running.  Proctab terminates a job when that job is deleted, disabled,
needs to be restarted due to changes to its command or arguments, is being
bounced, or proctab itself is shutting down.

.Externally-induced

If a job terminates by itself, when proctab did not signal it to exit, (and the
job does not have the `once` option), proctab restarts it. However, if the job
died within 10 seconds of starting, proctab waits 10 seconds to restart it.

.Restart management

This has two benefits: a job that is waiting for some resource (say, to connect
to a remote server that is temporarily offline) can exit, counting on being
restarted periodically, so it does not have to embed retry logic itself.
Secondly, a job that is misconfigured (say, with a typo in its command
string) has little impact on the host because proctab only tries to restart
every 10 seconds.

Status, control and logs
~~~~~~~~~~~~~~~~~~~~~~~~

To start, stop or get status of proctab, use the host system management commands.
Note that when you start proctab, it starts up all its jobs, just like at boot.
When you stop proctab, it signals all its jobs to terminate before it exits.

.On a systemd-based host

  systemctl status proctab
  systemctl start proctab
  systemctl stop proctab

.On many other systems

  service proctab status
  service proctab start
  service proctab stop

.Logs

Proctab logs to syslog, typically sent by the host system into the file
`/var/log/syslog` or `/var/log/messages`. Look there for messages about
proctab starting or restarting jobs, or errors in parsing `proctab.conf`.
You can also run `proctab -t` to check the syntax and report any errors.

.systemd features

On systemd-based hosts, `systemctl status proctab` gives a nice view of the
proctab process hierarchy, as shown at the bottom of this command output.</code></pre>
</div></div>
<div class="paragraph"><p>% systemctl status proctab
● proctab.service - proctab process manager
   Loaded: loaded (/lib/systemd/system/proctab.service; enabled)
   Active: active (running) since Mon 2015-11-23 02:18:58 UTC; 12min ago
     Docs: <a href="http://troydhanson.github.io/proctab">http://troydhanson.github.io/proctab</a>
 Main PID: 1463 (proctab)
   CGroup: /system.slice/proctab.service
           ├─1463 /usr/bin/proctab -F -c /etc/proctab.conf
           └─1556 /usr/bin/darkice -c /etc/darkice.cfg
           └─1557 /usr/bin/ssh -i key -TNL 5901:127.0.0.1:5901 192.168.0.1</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Also, to view proctab logs on a systemd-based host, you can use:

    journalctl -u proctab

[[config_options]]
Appendix A: Configuration options
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

These options may appear in a job definition.

[[options]]
[width="90%",cols="20m,50",grid="none",options="header"]
|===============================================================================
|option         | argument
|name           | descriptive job name used for logging - must be unique
|cmd            | executable (fully-qualified) and any arguments
|dir            | working directory (fully qualified) to run the process in
|out            | send stdout to this file
|err            | send stderr to this file
|in             | hook stdin to this file
|env            | environment variable setting `VAR=VALUE` (repeatable)
|user           | unix username under whose id to run the process
|ulimit         | a flag and value, or a curly-brace delimited list of them
|bounce every   | a time interval like 5m (five minutes) - units are `smhd`
|depends        | a curly-brace delimited list of files, one per line
|disable        | this keyword disables the job
|===============================================================================

More details on each option follows.

cmd
^^^
* The executable named in the `cmd` must have its executable-bit set.
* The `cmd` may include trailing arguments e.g. `cmd /bin/node server.js`.
* The `cmd` may contain double-quoted arguments e.g. `cmd /bin/echo "hello world"`
* The `cmd` does no shell expansion: no wildcards, backticks, variables, etc.
* If you need shell features in your command, wrap it with a shell script.
* You can wrap a shell script around something using this trick too:

  cmd /bin/bash -c "killall Xvnc; vncserver :1"

env
^^^
* Use `env` to push an environment variable into a job, e.g. `env TMPDIR=/tmp`.
* Use `env` repeatedly to set multiple environment variables.

disable
^^^^^^^
* Use `disable` to stop a job, without having to comment it out.
* This is often helpful in debugging a job since it makes it easy to
  re-enable the job later (by commenting out the disable line, or removing it).

out, err, in
^^^^^^^^^^^^
* Use `out`, `err`, and `in` to attach stdout, stderr or stdin to a file.
* The stdout, stderr and stdin default to `/dev/null`.

user
^^^^
* The `user` option is the unix username that should be the process owner.
* The `user` defaults to root usually, when proctab is running as a service.
* The `user` defaults to whoever started proctab, if proctab was run manually.

depends
^^^^^^^
* Use a `depends` block to specify files, one per line, that the job depends on.
* If the content of any of the dependencies changes, proctab restarts the job.

bounce every
^^^^^^^^^^^^
* The `bounce every` option restarts the job every so often.
* It's intended for jobs that don't behave well as long-running processes.
* It takes a number and unit, like `5m` to restart a job every five minutes.
* The units are `smhd`- (s)econds, (m)inutes, (h)ours or (d)ays.
* The interval should be more than 10 seconds.
* The exact timing of the restart is approximate.

ulimit
^^^^^^
* Use `ulimit` to modify the kernel-enforced resource limits for the job.
* It takes a flag denoting which limit to set, and a value, e.g., `ulimit -n 30`.
* Alternatively, you can list a series of ulimit settings in a curly brace block:

  ulimit {
    -n infinity
    -l 10000
  }

* In bash, type `ulimit -a` in bash to list flags, and the values in your shell;
* In bash, type `help ulimit` for more information about the ulimits;
* In bash, type `man prlimit` to see the more technical description and the units.
* The values are all numeric or the keyword `infinity`.
* To see the current kernel limits on a process, run `cat /proc/&lt;pid&gt;/limits`.
* proctab sets both the "hard" and "soft" ulimit to the same value.
* If there is an error setting the ulimits, it's logged to syslog.

One-time jobs
^^^^^^^^^^^^^
Normally proctab runs permanent processes. However proctab supports one-time "setup"
jobs using the `wait` and `once` options.

  job {
    name setup-ramdisk
    cmd /bin/mkdir /dev/shm/ss
    wait
    once
  }

With `wait`, proctab waits for the job to exit before starting subsequent jobs. The
`once` option prevents proctab from restarting it.

Appendix B: Proctab command-line options
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The host init system normally runs proctab at system boot. However you can run
proctab manually. These are the command line options that proctab accepts.

.proctab options
[width="80%",cols="20m,50",grid="none",options="none"]
|==========================================================================
| -h        | show help
| -F        | stay in foreground
| -c &lt;file&gt; | specify configuration file
| -t        | test syntax (parse config file and exit)
| -v        | verbose logging (repeatable), -vv shows parsing
| -p &lt;file&gt; | make pidfile
|==========================================================================


Appendix C: Network reporting and control
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

NOTE: These features are disabled by default.

These configuration options may appear in `proctab.conf` at the global scope.

  report to udp://127.0.0.1:9999
  listen on udp://0.0.0.0:10000

The `report to` option designates a remote address and port to which proctab
should send a a UDP packet every ten seconds.  The packet payload lists the job
names, enabled or disabled status, and elapsed runtimes in simple text. If the
`report to` address falls in the multicast UDP range (e.g. 239.0.0.1, etc), the
specification may include a trailing interface, e.g., `report to
udp://239.0.0.1:9999@eth2` to designate the interface from which the multicast
UDP datagrams should egress.

The `listen on` option allows jobs to be remotely enabled or disabled. It
specifies a UDP address and port that proctab should listen on for datagrams of
form `enable abc` or `disable abc`, where 'abc' is a job name.  The address
0.0.0.0 can be used as a shortcut to denote "any address" on this system.  The
effect is temporary; the settings in proctab.conf resume precedence when it's
edited or proctab is restarted.

These options are considered experimental and may be replaced or removed.

// vim: set tw=80 wm=2 syntax=asciidoc:</code></pre>
</div></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2016-01-28 23:59:49 EST
</div>
</div>
</body>
</html>
