<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>pmtr: a Linux process supervisor</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>pmtr: a Linux process supervisor</h1>
<span id="author">Troy D. Hanson</span><br />
<span id="email"><code>&lt;<a href="mailto:tdh@tkhanson.net">tdh@tkhanson.net</a>&gt;</code></span><br />
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Back to the <a href="https://github.com/troydhanson/pmtr">pmtr Github page</a>.</p></div>
<div class="paragraph"><p>Most Linux services start from initscripts. In some situations it&#8217;s easier to
supervise a collection of processes through one configuration file.  I wrote
pmtr to manage my appliance processes. With everything in one place I can see
the overall configuration more easily and keep this file in source control.</p></div>
<div class="paragraph"><p>I use pmtr primarily on Ubuntu (versions 12 through 15) and CentOS (versions 5-6).</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_pmtr">pmtr</h2>
<div class="sectionbody">
<div class="paragraph"><p>The config file <code>/etc/pmtr.conf</code> lists the services (jobs) for pmtr to run.
It is meant to run permanent processes.  It restarts processes that exit.</p></div>
<div class="listingblock">
<div class="title">Example <code>/etc/pmtr.conf</code></div>
<div class="content">
<pre><code>  job {
    name application-proxy
    cmd /bin/aproxy -j 10 -l 127.0.0.1
    err /var/log/aproxy.err
  }

  job {
    name ssh-tunnel
    cmd /usr/bin/ssh -i key -TNL 5901:127.0.0.1:5901 box
  }

  job {
    name snmp-mon
    cmd /usr/bin/snmp-mon -c snmp.conf
    env LD_LIBRARY_PATH=/opt/lib
    ulimit -n infinity
    bounce every 1d
    user daemon
    depends {
      snmp.conf
      device.oid
    }
  }</code></pre>
</div></div>
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph"><p>Pmtr is free and open source. Here is the <a href="LICENSE.txt">LICENSE</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_about">About</h3>
<div class="paragraph"><p>Pmtr is one of my hobby projects. I wrote it for managing appliances that had a
a dozen or two related processes. It is written in C. I wanted to roll my own so
that I could go my own way with pmtr whenever I wanted to hack in new features,
and because, well, <a href="http://troydhanson.github.io/">I write lots of C code</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_build_and_install">Build and Install</h3>
<div class="literalblock">
<div class="content">
<pre><code>git clone https://github.com/troydhanson/pmtr.git
cd pmtr
make
sudo make install</code></pre>
</div></div>
<div class="paragraph"><p>Afterward pmtr should already be running. Verify using <code>service pmtr status</code>.
The result of installation is:</p></div>
<div class="ulist"><ul>
<li>
<p>
the executable: <code>/usr/bin/pmtr</code>
</p>
</li>
<li>
<p>
the configuration file: <code>/etc/pmtr.conf</code>
</p>
</li>
<li>
<p>
an OS-specific initscript that runs pmtr at boot
</p>
</li>
</ul></div>
<div class="paragraph"><p>You can use the system&#8217;s service command to start or stop pmtr itself.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>service pmtr start
service pmtr stop</code></pre>
</div></div>
<div class="paragraph"><p>When you stop pmtr, it stops the jobs that it&#8217;s supervising and then itself.
Pmtr logs to syslog. This is typically <code>/var/log/syslog</code> or <code>/var/log/messages</code>.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Nov  7 1:38:10 ubuntu pmtr[477]: started job proxy [478]
Nov  7 1:38:20 ubuntu pmtr[477]: job proxy [478] exited after 10 sec: exit status 0</code></pre>
</div></div>
<div class="paragraph"><p>Normally pmtr runs in the background. You can start it in the foreground using <code>-F</code>.</p></div>
<div class="tableblock">
<table rules="none"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. pmtr options</caption>
<col width="28%" />
<col width="71%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>-F</code></p></td>
<td align="left" valign="top"><p class="table">stay in foreground</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-c &lt;file&gt;</code></p></td>
<td align="left" valign="top"><p class="table">specify alternate configuration file</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-t</code></p></td>
<td align="left" valign="top"><p class="table">test syntax (parse config file and exit)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-v</code></p></td>
<td align="left" valign="top"><p class="table">verbose logging (repeatable), -vv shows parsing</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_jobs">Jobs</h3>
<div class="paragraph"><p>Processes that run under pmtr should,</p></div>
<div class="ulist"><ul>
<li>
<p>
stay in the foreground
</p>
</li>
<li>
<p>
exit on SIGTERM or SIGKILL
</p>
</li>
<li>
<p>
clean up their own sub-processes
</p>
</li>
</ul></div>
<div class="paragraph"><p>The default pmtr configuration file is <code>/etc/pmtr.conf</code>.</p></div>
<div class="paragraph"><p>When you edit and save <code>pmtr.conf</code>, it applies the changes immediately.</p></div>
<div class="ulist"><ul>
<li>
<p>
A newly-added job gets started.
</p>
</li>
<li>
<p>
A deleted job is terminated.
</p>
</li>
<li>
<p>
A changed job is restarted with its new configuration.
</p>
</li>
</ul></div>
<div class="paragraph"><p>To terminate a job, pmtr sends SIGTERM to it, then SIGKILL shortly afterward.</p></div>
<div class="sect3">
<h4 id="_syntax">Syntax</h4>
<div class="paragraph"><p>The configuration file contains any number of jobs.</p></div>
<div class="ulist"><ul>
<li>
<p>
Each job is in a curly-brace delimited block.
</p>
</li>
<li>
<p>
The order of options inside does not matter.
</p>
</li>
<li>
<p>
Only the <code>name</code> and <code>cmd</code> are required.
</p>
</li>
<li>
<p>
Indentation is optional.
</p>
</li>
<li>
<p>
Blank lines are ok.
</p>
</li>
<li>
<p>
Comments start with <code>#</code> and must be on their own line.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Example job</div>
<div class="content">
<pre><code>  job {
    name snmp-mon
    cmd /usr/bin/snmp-mon -c snmp.conf
    env LD_LIBRARY_PATH=/opt/lib
    ulimit -n infinity
    bounce every 1d
    user daemon
    depends {
      snmp.conf
      device.oid
    }
  }</code></pre>
</div></div>
<div class="paragraph"><p>These options may appear in a job definition.</p></div>
<div class="tableblock" id="options">
<table rules="none"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="28%" />
<col width="71%" />
<thead>
<tr>
<th align="left" valign="top">option         </th>
<th align="left" valign="top"> argument</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>name</code></p></td>
<td align="left" valign="top"><p class="table">descriptive job name used for logging - must be unique</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>cmd</code></p></td>
<td align="left" valign="top"><p class="table">executable (fully-qualified) and any arguments</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>dir</code></p></td>
<td align="left" valign="top"><p class="table">working directory (fully qualified) to run the process in</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>out</code></p></td>
<td align="left" valign="top"><p class="table">send stdout to this file</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>err</code></p></td>
<td align="left" valign="top"><p class="table">send stderr to this file</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>in</code></p></td>
<td align="left" valign="top"><p class="table">hook stdin to this file</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>env</code></p></td>
<td align="left" valign="top"><p class="table">environment variable setting <code>VAR=VALUE</code> (repeatable)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>user</code></p></td>
<td align="left" valign="top"><p class="table">unix username under whose id to run the process</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>ulimit</code></p></td>
<td align="left" valign="top"><p class="table">a flag and value, or a curly-brace delimited list of them</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>bounce every</code></p></td>
<td align="left" valign="top"><p class="table">a time interval like 5m (five minutes) - units are <code>smhd</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>depends</code></p></td>
<td align="left" valign="top"><p class="table">a curly-brace delimited list of files, one per line</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>disable</code></p></td>
<td align="left" valign="top"><p class="table">this keyword disables the job</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>More details on each option follows.</p></div>
</div>
<div class="sect3">
<h4 id="_cmd">cmd</h4>
<div class="ulist"><ul>
<li>
<p>
The executable named in the <code>cmd</code> must have its executable-bit set.
</p>
</li>
<li>
<p>
The <code>cmd</code> may include trailing arguments e.g. <code>cmd /bin/node server.js</code>.
</p>
</li>
<li>
<p>
The <code>cmd</code> may contain double-quoted arguments e.g. <code>cmd /bin/echo "hello world"</code>
</p>
</li>
<li>
<p>
The <code>cmd</code> does no shell expansion: no wildcards, backticks, variables, etc.
</p>
</li>
<li>
<p>
If you need shell features in your command, wrap it with a shell script.
</p>
</li>
<li>
<p>
You can wrap a shell script around something using this trick too:
</p>
<div class="literalblock">
<div class="content">
<pre><code>cmd /bin/bash -c "killall Xvnc; vncserver :1"</code></pre>
</div></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_env">env</h4>
<div class="ulist"><ul>
<li>
<p>
Use <code>env</code> to push an environment variable into a job, e.g. <code>env TMPDIR=/tmp</code>.
</p>
</li>
<li>
<p>
Use <code>env</code> repeatedly to set multiple environment variables.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_disable">disable</h4>
<div class="ulist"><ul>
<li>
<p>
Use <code>disable</code> to stop a job, without having to comment it out.
</p>
</li>
<li>
<p>
This is often helpful in debugging a job since it makes it easy to
  re-enable the job later (by commenting out the disable line, or removing it).
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_out_err_in">out, err, in</h4>
<div class="ulist"><ul>
<li>
<p>
Use <code>out</code>, <code>err</code>, and <code>in</code> to attach stdout, stderr or stdin to a file.
</p>
</li>
<li>
<p>
The stdout, stderr and stdin default to <code>/dev/null</code>.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_user">user</h4>
<div class="ulist"><ul>
<li>
<p>
The <code>user</code> option is the unix username that should be the process owner.
</p>
</li>
<li>
<p>
The <code>user</code> defaults to root usually, when pmtr is running as a service.
</p>
</li>
<li>
<p>
The <code>user</code> defaults to whoever started pmtr, if pmtr was run manually.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_depends">depends</h4>
<div class="ulist"><ul>
<li>
<p>
Use a <code>depends</code> block to specify files, one per line, that the job depends on.
</p>
</li>
<li>
<p>
If the content of any of the dependencies changes, pmtr restarts the job.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_bounce_every">bounce every</h4>
<div class="ulist"><ul>
<li>
<p>
The <code>bounce every</code> option restarts the job every so often.
</p>
</li>
<li>
<p>
It&#8217;s intended for jobs that don&#8217;t behave well as long-running processes.
</p>
</li>
<li>
<p>
It takes a number and unit, like <code>5m</code> to restart a job every five minutes.
</p>
</li>
<li>
<p>
The units are <code>smhd</code>- (s)econds, (m)inutes, (h)ours or (d)ays.
</p>
</li>
<li>
<p>
The interval should be more than 10 seconds.
</p>
</li>
<li>
<p>
The exact timing of the restart is approximate.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_ulimit">ulimit</h4>
<div class="ulist"><ul>
<li>
<p>
Use <code>ulimit</code> to modify the kernel-enforced resource limits for the job.
</p>
</li>
<li>
<p>
It takes a flag denoting which limit to set, and a value, e.g., <code>ulimit -n 30</code>.
</p>
</li>
<li>
<p>
Alternatively, you can list a series of ulimit settings in a curly brace block:
</p>
<div class="literalblock">
<div class="content">
<pre><code>ulimit {
  -n infinity
  -l 10000
}</code></pre>
</div></div>
</li>
<li>
<p>
In bash, type <code>ulimit -a</code> in bash to list flags, and the values in your shell;
</p>
</li>
<li>
<p>
In bash, type <code>help ulimit</code> for more information about the ulimits;
</p>
</li>
<li>
<p>
In bash, type <code>man prlimit</code> to see the more technical description and the units.
</p>
</li>
<li>
<p>
The values are all numeric or the keyword <code>infinity</code>.
</p>
</li>
<li>
<p>
To see the current kernel limits on a process, run <code>cat /proc/&lt;pid&gt;/limits</code>.
</p>
</li>
<li>
<p>
pmtr sets both the "hard" and "soft" ulimit to the same value.
</p>
</li>
<li>
<p>
If there is an error setting the ulimits, it&#8217;s logged to syslog.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_restarts">Restarts</h4>
<div class="paragraph"><p>Since pmtr is designed to keep things running, if a job exits, pmtr restarts it.</p></div>
<div class="ulist"><ul>
<li>
<p>
If a job exits quickly (within ten seconds of when it started) pmtr
  waits ten seconds then restarts it. This avoids rapid restart cycles. The
  job probably has some sort of configuration problem if it exits quickly.
</p>
</li>
<li>
<p>
Exit status 33 can be returned from a process to tell pmtr not to restart it.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_one_time_jobs">One-time jobs</h4>
<div class="paragraph"><p>Normally pmtr runs permanent processes. However pmtr supports one-time "setup"
jobs using the <code>wait</code> and <code>once</code> options.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>job {
  name setup-ramdisk
  cmd /bin/mkdir /dev/shm/ss
  wait
  once
}</code></pre>
</div></div>
<div class="paragraph"><p>With <code>wait</code>, pmtr waits for the job to exit before starting subsequent jobs. The
<code>once</code> option prevents pmtr from restarting it.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_experimental">Experimental</h3>
<div class="paragraph"><p>These features are disabled by default.</p></div>
<div class="paragraph"><p>These configuration options may appear in <code>pmtr.conf</code> at the global scope.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>report to udp://127.0.0.1:9999
listen on udp://0.0.0.0:10000</code></pre>
</div></div>
<div class="paragraph"><p>The <code>report to</code> option designates a remote address and port to which pmtr should
send a a UDP packet every ten seconds.  The packet payload lists the job names,
enabled or disabled status, and elapsed runtimes in simple text. (An included
script <code>pmtr/utils/pmtr-rptserver</code> can receive these reports and write updates
to a text file summarizing the received status messages. This script is invoked
like <code>pmtr-rptserver -p 9999 -f status.txt</code>).  If the <code>report to</code> address falls
in the multicast UDP range (e.g.  239.0.0.1, etc), the specification may include
a trailing interface, e.g., <code>report to udp://239.0.0.1:9999@eth2</code> to explicitly
designate the interface from which the multicast UDP datagrams should egress.</p></div>
<div class="paragraph"><p>The <code>listen on</code> option allows jobs to be remotely enabled or disabled. It
specifies a UDP address and port that pmtr should listen on for datagrams of
form <code>enable abc</code> or <code>disable abc</code>, where <em>abc</em> is a job name.  The address
0.0.0.0 can be used as a shortcut to denote "any address" on this system. (A
script in <code>pmtr/utils/pmtr-ctl</code> may be used to send the datagrams, for example
<code>pmtr-ctl -s 192.168.0.22 -p 10000 enable abc</code>). The effect is temporary; the
settings in pmtr.conf resume precedence when it&#8217;s edited or pmtr is restarted.</p></div>
</div>
<div class="sect2">
<h3 id="_tips">Tips</h3>
<div class="sect3">
<h4 id="_pstree">pstree</h4>
<div class="paragraph"><p>To get a nice visual confirmation of the jobs you have running under pmtr, you
can use the <code>pstree</code> utility, if you have it installed.  Here is the output of
<code>pstree -p</code>.</p></div>
<div class="listingblock">
<div class="title">Example pstree output</div>
<div class="content">
<pre><code>        ├─pmtr(2830)─┬─pmtr(2834)
        │            ├─proxy(2831)
        │            ├─sshd(2832)
        │            └─python(2833)</code></pre>
</div></div>
<div class="paragraph"><p>The other system processes have been omitted. Note that pmtr has its own child
process. This is the dependency monitor that watches the config file.</p></div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-06 18:13:42 EDT
</div>
</div>
</body>
</html>
