<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.7" />
<title>pmtr: process monitor</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>pmtr: process monitor</h1>
<span id="author">Troy D. Hanson</span><br />
<span id="email"><tt>&lt;<a href="mailto:tdh@tkhanson.net">tdh@tkhanson.net</a>&gt;</tt></span><br />
<span id="revdate">v1.7 July 2014</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="float:right">
<a href="https://twitter.com/troydhanson" class="twitter-follow-button" data-show-count="false">Follow @troydhanson</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<a href="https://twitter.com/share" class="twitter-share-button" data-via="troydhanson">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>
<div class="paragraph"><p>Back to the <a href="https://github.com/troydhanson/pmtr">pmtr Github page</a>.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
pmtr
</dt>
<dd>
<p>
  a Linux process supervisor that can start your executables or scripts,
  usually at system boot, then monitor and restart them as needed
</p>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_pmtr_process_monitor">pmtr: process monitor</h2>
<div class="sectionbody">
<div class="paragraph"><p>Pmtr is a supervisor daemon that starts your programs and then babysits them.
Most "standard" system services (httpd, sshd, etc) have initscripts, which are
the typical way to run daemons on Linux. For programs you wrote yourself, or
your local application servers that don&#8217;t have initscripts, you might find
pmtr easier to use or its features beneficial. Your jobs go in pmtr.conf:</p></div>
<div class="listingblock">
<div class="title">Example <tt>/etc/pmtr.conf</tt></div>
<div class="content">
<pre><tt>  job {
    name rest_server
    cmd /usr/bin/python rest.py
  }

  # set working directory, keep errors
  job {
    name ws-server
    dir /home/maps
    cmd /usr/bin/node maps.js
    err /tmp/maps.err
  }

  # restart if dependencies change
  job {
    name proxy
    cmd /usr/bin/proxy -c /etc/proxy.cfg
    depends {
      /etc/proxy.cfg
    }
  }

  # bounce this job every hour, set ulimits
  job {
    name thermostat
    dir /home/thermo
    cmd /usr/bin/python therm.py
    bounce every 1h
    ulimit -n 10
    user nobody
  }</tt></pre>
</div></div>
<div class="paragraph"><p>See the <a href="#options">full options</a> below, and the <a href="#requirements">requirements</a>
for pmtr jobs. Pmtr applies changes immediately when the config file is edited.
The pmtr daemon itself is small, written in C, open-source and for Linux only.
It runs on Ubuntu, Debian, RHEL/CentOS, in Docker containers, and others.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Why did I write it?</div>
<div class="paragraph"><p>I wrote pmtr because I wanted one simple configuration file where I could
list all my programs, knowing that they&#8217;d be run at boot, get restarted if
they exit, and they&#8217;d react immediately to configuration files changes.</p></div>
</div></div>
<div class="paragraph"><div class="title">Does it work?</div><p>The author has used pmtr for several years in production on hundreds of systems
having dozens of jobs each.  If you find a bug or have a new feature to suggest-
please use the <a href="https://github.com/troydhanson/pmtr">pmtr Github page</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_download_amp_install">Download &amp; Install</h2>
<div class="sectionbody">
<div class="paragraph"><p>You can use the <a href="https://github.com/troydhanson/pmtr">Github page</a> to:</p></div>
<div class="ulist"><ul>
<li>
<p>
download a <a href="https://github.com/troydhanson/pmtr/archive/master.zip">zipfile</a>.
</p>
</li>
<li>
<p>
or, git clone <a href="https://github.com/troydhanson/pmtr.git">https://github.com/troydhanson/pmtr.git</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To build and install:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>cd pmtr
make
sudo make install</tt></pre>
</div></div>
<div class="paragraph"><p>The result of installation is:</p></div>
<div class="ulist"><ul>
<li>
<p>
the executable: <tt>/usr/bin/pmtr</tt>
</p>
</li>
<li>
<p>
the configuration file: <tt>/etc/pmtr.conf</tt>
</p>
</li>
<li>
<p>
an OS-specific initscript to run pmtr at boot
</p>
</li>
</ul></div>
<div class="paragraph"><p>It should already be running. Verify using <tt>service pmtr status</tt>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_command_line_options">Command line options</h2>
<div class="sectionbody">
<div class="paragraph"><p>While pmtr is normally run as a background service, you can run it manually on
the command line, in which case you can specify these flags:</p></div>
<div class="tableblock">
<table rules="none"
width="70%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="28%" />
<col width="71%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>-c &lt;file&gt;</tt></p></td>
<td align="left" valign="top"><p class="table">specify alternate configuration file</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>-t</tt></p></td>
<td align="left" valign="top"><p class="table">test only- parse config file and exit (implies -F)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>-F</tt></p></td>
<td align="left" valign="top"><p class="table">Foreground (stay in foreground instead of detaching)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>-v</tt></p></td>
<td align="left" valign="top"><p class="table">verbose (use -vv to see token parsing)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_file">Configuration file</h2>
<div class="sectionbody">
<div class="paragraph"><p>The default pmtr configuration file is <tt>/etc/pmtr.conf</tt>.</p></div>
<div class="sect2">
<h3 id="_syntax">Syntax</h3>
<div class="paragraph"><p>The configuration file contains any number of jobs.</p></div>
<div class="ulist"><ul>
<li>
<p>
Each job is in a curly-brace delimited block.
</p>
</li>
<li>
<p>
The order of options inside does not matter.
</p>
</li>
<li>
<p>
Indentation is optional.
</p>
</li>
<li>
<p>
Blank lines are ok.
</p>
</li>
<li>
<p>
Comments start with <tt>#</tt> and must be on their own line.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">A job with many options</div>
<div class="content">
<pre><tt>  # trending service
  # restarted daily

  job {
    name trends
    dir /home/trends
    cmd /usr/bin/python trends.py "Hourly Trends"
    out trends.out
    err trends.err
    bounce every 1d
    ulimit -n 30
    env LIBS=/opt/libs
    env DEBUG=1
    user pyuser
    depends {
      trends.conf
      /etc/py.conf
    }
  }</tt></pre>
</div></div>
<div class="sect3">
<h4 id="_options">Options</h4>
<div class="tableblock" id="options">
<table rules="none"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="28%" />
<col width="71%" />
<thead>
<tr>
<th align="left" valign="top">option         </th>
<th align="left" valign="top"> argument</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>name</tt></p></td>
<td align="left" valign="top"><p class="table">descriptive job name used for logging - must be unique</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>cmd</tt></p></td>
<td align="left" valign="top"><p class="table">executable (fully-qualified) and any arguments</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>dir</tt></p></td>
<td align="left" valign="top"><p class="table">working directory (fully qualified) to run the process in</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>out</tt></p></td>
<td align="left" valign="top"><p class="table">send stdout to this file</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>err</tt></p></td>
<td align="left" valign="top"><p class="table">send stderr to this file</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>in</tt></p></td>
<td align="left" valign="top"><p class="table">hook stdin to this file</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>env</tt></p></td>
<td align="left" valign="top"><p class="table">environment variable setting <tt>VAR=VALUE</tt> (repeatable)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>user</tt></p></td>
<td align="left" valign="top"><p class="table">unix username under whose id to run the process</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>ulimit</tt></p></td>
<td align="left" valign="top"><p class="table">an option and a numeric value, like <tt>-n 30</tt></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>bounce every</tt></p></td>
<td align="left" valign="top"><p class="table">a time interval like 5m (five minutes) - units are <tt>smhd</tt></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>depends</tt></p></td>
<td align="left" valign="top"><p class="table">a curly-brace delimited list of files, one per line</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>disable</tt></p></td>
<td align="left" valign="top"><p class="table">this keyword disables the job</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Further details:</p></div>
<div class="ulist"><ul>
<li>
<p>
The required entries are <tt>name</tt> and <tt>cmd</tt>.
</p>
</li>
<li>
<p>
The executable named in the <tt>cmd</tt> must have its executable-bit set.
</p>
</li>
<li>
<p>
The <tt>cmd</tt> may include trailing arguments e.g. <tt>cmd /bin/node server.js</tt>.
</p>
</li>
<li>
<p>
The <tt>cmd</tt> may contain double-quoted arguments e.g. <tt>cmd /bin/echo "hello world"</tt>
</p>
</li>
<li>
<p>
The <tt>cmd</tt> does no shell expansion: no wildcards, backticks, environment
  variables, etc. To use shell features, wrap your executable with a script
  or invoke the shell inline like <tt>cmd /bin/bash -c "/bin/node my.js $DIR"</tt>.
</p>
</li>
<li>
<p>
Use <tt>env</tt> to push an environment variable into a job, e.g. <tt>env TMPDIR=/tmp</tt>.
</p>
</li>
<li>
<p>
Use <tt>env</tt> repeatedly to set multiple environment variables.
</p>
</li>
<li>
<p>
Use <tt>disable</tt> to stop a job, without having to comment it out.
</p>
</li>
<li>
<p>
Use <tt>out</tt>, <tt>err</tt>, and <tt>in</tt> to attach stdout, stderr or stdin to a file.
</p>
</li>
<li>
<p>
The stdout, stderr and stdin default to <tt>/dev/null</tt>.
</p>
</li>
<li>
<p>
The <tt>user</tt> option designates the unix username to run the job (default: root)
</p>
</li>
<li>
<p>
Use <tt>ulimit</tt> to modify the kernel-enforced resource limits for the job.
  It takes a flag denoting which limit to set, and a value, e.g., <tt>ulimit -n
  30</tt>. Only the <tt>-n</tt> flag (maximum file descriptors) has been implemented. The
  flag names are planned to be identical with those used by the bash shell-
  (type <tt>ulimit -a</tt> in bash to list them). Also see the <tt>setrlimit(2)</tt> man page.
</p>
</li>
<li>
<p>
The <tt>bounce every</tt> option kills and restarts the job every so often. It
  is intended for jobs that don&#8217;t behave well as long-running processes. It
  takes a number and unit, like <tt>5m</tt> to restart a job every five minutes. The
  units are <tt>smhd</tt>- (s)econds, (m)inutes, (h)ours or (d)ays. The bounce timer
  runs every 10s- it&#8217;s not for short intervals.
</p>
</li>
<li>
<p>
Use <tt>depends</tt> to specify files that, if their content changes, should cause
  pmtr to restart the job.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="requirements">Job requirements</h3>
<div class="paragraph"><p>In pmtr the term <em>job</em> means a daemon. For our purposes, this is just
some executable- a binary or script- that you want to keep running. It must:</p></div>
<div class="ulist"><ul>
<li>
<p>
stay in the foreground
</p>
</li>
<li>
<p>
exit on SIGTERM or SIGKILL
</p>
</li>
<li>
<p>
clean up any sub-processes when it exits
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_checking_config_syntax">Checking config syntax</h3>
<div class="paragraph"><p>To check the syntax of a configuration file, use the <tt>-t</tt> (test) flag:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>pmtr -tc /etc/pmtr.conf</tt></pre>
</div></div>
<div class="paragraph"><p>This displays any syntax errors. In normal operation when pmtr is in the
background, it logs syntax errors via syslog- see <a href="#logging">logging</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_when_do_configuration_changes_take_effect">When do configuration changes take effect?</h3>
<div class="paragraph"><p>When you edit and save <tt>pmtr.conf</tt>, the changes get applied immediately.</p></div>
<div class="ulist"><ul>
<li>
<p>
A newly-added job gets started.
</p>
</li>
<li>
<p>
A deleted job is terminated.
</p>
</li>
<li>
<p>
A changed job is restarted with its new configuration.
</p>
</li>
</ul></div>
<div class="paragraph"><p>To terminate a job, pmtr sends SIGTERM to it, then SIGKILL shortly afterward.</p></div>
</div>
<div class="sect2">
<h3 id="_one_time_jobs">One-time jobs</h3>
<div class="paragraph"><p>For "initial setup" situations, pmtr has basic support for one-time jobs. The
<tt>wait</tt> option makes pmtr wait for the job to exit before starting subsequent
jobs. To keep pmtr from restarting it, use the <tt>once</tt> option.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>job {
      name create-ramdisk
      cmd /bin/mkdir -p /dev/shm/ws/data
      wait
      once
}</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_experimental">Experimental</h3>
<div class="paragraph"><p>These features are disabled by default.</p></div>
<div class="paragraph"><p>These configuration options may appear in <tt>pmtr.conf</tt> at the global scope.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>report to udp://127.0.0.1:9999
listen on udp://0.0.0.0:10000</tt></pre>
</div></div>
<div class="paragraph"><p>The <tt>report to</tt> option designates a remote address and port to which pmtr should
send a a UDP packet every ten seconds.  The packet payload lists the job names,
enabled or disabled status, and elapsed runtimes in simple text. (An included
script <tt>pmtr/utils/pmtr-rptserver</tt> can receive these reports and write updates
to a text file summarizing the received status messages. This script is invoked
like <tt>pmtr-rptserver -p 9999 -f status.txt</tt>).  If the <tt>report to</tt> address falls
in the multicast UDP range (e.g.  239.0.0.1, etc), the specification may include
a trailing interface, e.g., <tt>report to udp://239.0.0.1:9999@eth2</tt> to explicitly
designate the interface from which the multicast UDP datagrams should egress.</p></div>
<div class="paragraph"><p>The <tt>listen on</tt> option allows jobs to be remotely enabled or disabled. It
specifies a UDP address and port that pmtr should listen on for datagrams of
form <tt>enable abc</tt> or <tt>disable abc</tt>, where <em>abc</em> is a job name.  The address
0.0.0.0 can be used as a shortcut to denote "any address" on this system. (A
script in <tt>pmtr/utils/pmtr-ctl</tt> may be used to send the datagrams, for example
<tt>pmtr-ctl -s 192.168.0.22 -p 10000 enable abc</tt>). The effect is temporary, until
pmtr.conf is edited or pmtr is restarted.conf settings apply.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pstree">pstree</h2>
<div class="sectionbody">
<div class="paragraph"><p>To get a nice visual confirmation of the jobs you have running under pmtr, you
can use the <tt>pstree</tt> utility, if you have it installed.  Here is the output of
<tt>pstree -p</tt> with the PID&#8217;s.</p></div>
<div class="listingblock">
<div class="title">Example pstree output</div>
<div class="content">
<pre><tt>        ├─pmtr(2830)─┬─pmtr(2834)
        │            ├─proxy(2831)
        │            ├─sshd(2832)
        │            └─python(2833)</tt></pre>
</div></div>
<div class="paragraph"><p>The rest of the system processes have been omitted. Note that pmtr has its
own child process. This is the dependency monitor that watches the config file.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_restarts">Restarts</h2>
<div class="sectionbody">
<div class="paragraph"><p>Since pmtr is designed to keep things running, if a job exits, pmtr restarts it.</p></div>
<div class="ulist"><ul>
<li>
<p>
If a job exits quickly- within ten seconds of when it started- pmtr
  waits ten seconds to restart it. This avoids rapid restart cycles. The
  job probably has some sort of configuration problem if it exits quickly.
</p>
</li>
<li>
<p>
Exit status 33 can be returned from a process to tell pmtr not to restart it.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="logging">Logging</h2>
<div class="sectionbody">
<div class="paragraph"><p>Look in syslog (typically <tt>/var/log/messages</tt> or <tt>/var/log/syslog</tt>) to see
pmtr log messages relating to configuration file changes and job activity.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Nov  7 21:38:09 ubuntu pmtr[18477]: rescanning job configuration
Nov  7 21:38:10 ubuntu pmtr[18477]: started job proxy [18478]
Nov  7 21:38:20 ubuntu pmtr[18477]: job proxy [18478] exited after 10 sec: exit status 0</tt></pre>
</div></div>
<div class="paragraph"><p>If your job isn&#8217;t running, this is the first place to look. Pmtr is verbose
about restarting jobs, or indicating if they are exiting for some reason.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
Please use the <a href="https://github.com/troydhanson/pmtr">pmtr Github page</a> for bug reports and pull requests.
</p>
</li>
<li>
<p>
The <a href="http://troydhanson.github.io/">author&#8217;s GitHub page</a> lists my other software.
</p>
</li>
<li>
<p>
My <a href="http://tkhanson.net/blog">blog</a>, and twitter <a href="https://twitter.com/troydhanson">@troydhanson</a>.
</p>
</li>
<li>
<p>
You can email me at <a href="mailto:tdh@tkhanson.net">tdh@tkhanson.net</a>. I may not be able to reply- sorry!
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph"><p>See the <a href="LICENSE.txt">LICENSE</a> file.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2014-07-05 08:51:45 EDT
</div>
</div>
</body>
</html>
